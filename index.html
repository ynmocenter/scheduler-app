<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام مواعيد المركز</title>
  <style>
    :root {--primary:#012A4A;--secondary:#ADE8F4;--behavior:#FFCDB2;--speech:#BDE0FE;--skill:#FED7C3;--psych:#D3BDE0;--iq:#E8D3FE;--bg:#f5f5f5;--text:#012A4A;}
    *{box-sizing:border-box;}
    body{font-family:Arial,sans-serif;margin:0;padding:0;background:var(--bg);color:var(--text);}
    header{background:var(--primary);color:#fff;padding:10px;display:flex;align-items:center;justify-content:center;}
    nav.main, nav.sub{background:var(--secondary);padding:10px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
    nav.main button, nav.sub button{background:var(--primary);color:#fff;border:none;padding:6px 12px;cursor:pointer;border-radius:4px;}
    nav.main button.active, nav.sub button.active{background:var(--text);}
    section{display:none;padding:20px;}
    section.active{display:block;}
    .form-group{margin-bottom:12px;}
    label{display:block;margin-bottom:4px;font-weight:bold;}
    input,select{width:100%;padding:6px;margin-bottom:8px;border:1px solid #ccc;border-radius:4px;}
    select[multiple]{height:100px;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{border:1px solid #ccc;padding:8px;text-align:center;}
    th{background:var(--secondary);}
    .btn{background:var(--primary);color:#fff;border:none;padding:6px 12px;cursor:pointer;border-radius:4px;}
    .delete-btn{background:#e63946;}
    .dept-تعديل\ سلوك{background:var(--behavior);} .dept-تخاطب{background:var(--speech);} .dept-تنمية\ مهارات{background:var(--skill);} .dept-جلسة\ نفسية{background:var(--psych);} .dept-اختبار\ ذكاء{background:var(--iq);} .state-محجوز{opacity:1;} .state-متاح{opacity:0.3;}
  </style>
</head>
<body>
<header><h1>نظام مواعيد المركز</h1></header>
<nav class="main">
  <button data-target="specialists" class="active">الأخصائيون</button>
  <button data-target="children">الأطفال</button>
  <button data-target="schedule">الجدول</button>
  <button data-target="replacements">التعويضات</button>
</nav>

<section id="specialists" class="active">
  <h2>إدارة الأخصائيين</h2>
  <div class="form-group"><label>الاسم:</label><input id="specName"></div>
  <div class="form-group"><label>القسم:</label><select id="specDept"></select></div>
  <div class="form-group"><label>الإيميل:</label><input id="specEmail" type="email"></div>
  <div class="form-group"><label>أيام العمل:</label><select id="specDays" multiple><option>السبت</option><option>الأحد</option><option>الاثنين</option><option>الثلاثاء</option><option>الأربعاء</option><option>الخميس</option></select></div>
  <div class="form-group"><label>الفترات المتاحة:</label><select id="specSlots" multiple></select></div>
  <button class="btn" onclick="addSpec()">إضافة أخصائي</button>
  <table><thead><tr><th>الاسم</th><th>القسم</th><th>إيميل</th><th>أيام</th><th>فترات</th><th>إجراء</th></tr></thead><tbody id="tblSpecs"></tbody></table>
</section>

<section id="children">
  <h2>إدارة الأطفال</h2>
  <div class="form-group"><label>الاسم:</label><input id="childName"></div>
  <div class="form-group"><label>الأخصائي:</label><input id="childSpec" placeholder="اكتب اسم الأخصائي"></div>
  <div class="form-group"><label>الاحتياجات:</label><select id="childNeeds" multiple></select></div>
  <div class="form-group"><label>خطة الاشتراك:</label><select id="childPlan"></select></div>
  <div class="form-group"><label>أيام (اختر):</label><select id="childDays" multiple><option>السبت</option><option>الأحد</option><option>الاثنين</option><option>الثلاثاء</option><option>الأربعاء</option><option>الخميس</option></select></div>
  <div class="form-group"><label>فترات (اختر):</label><select id="childSlots" multiple></select></div>
  <button class="btn" onclick="addChild()">إضافة طفل</button>
  <table><thead><tr><th>الطفل</th><th>أخصائي</th><th>احتياجات</th><th>خطة</th><th>أيام</th><th>فترات</th><th>إجراء</th></tr></thead><tbody id="tblChildren"></tbody></table>
</section>

<section id="schedule">
  <h2>الجدول الأسبوعي حسب الأقسام</h2>
  <nav class="sub">
    <button data-sec="تعديل سلوك">تعديل سلوك</button>
    <button data-sec="تخاطب">تخاطب</button>
    <button data-sec="تنمية مهارات">تنمية مهارات</button>
    <button data-sec="جلسة نفسية">جلسة نفسية</button>
    <button data-sec="اختبار ذكاء">اختبار ذكاء</button>
  </nav>
  <div id="scheduleContainer"></div>
  <button class="btn" onclick="autoAssign()">توزيع تلقائي</button>
  <button class="btn" onclick="sendEmails()">إرسال للجميع</button>
</section>

<section id="replacements">
  <h2>التعويضات</h2>
  <button class="btn" onclick="showFreeSlots()">عرض التعويضات</button>
  <table><thead><tr><th>اليوم</th><th>فترة</th><th>طفل</th><th>إجراء</th></tr></thead><tbody id="tblFree"></tbody></table>
</section>

<script>
const days=['السبت','الأحد','الاثنين','الثلاثاء','الأربعاء','الخميس'];
const depts=['تعديل سلوك','تخاطب','تنمية مهارات','جلسة نفسية','اختبار ذكاء'];
const plans=['24 جلسة','36 جلسة','ساعة اختبار','ساعتين اختبار','48 جلسة'];
const slots=['1:00 PM-1:40 PM','1:40 PM-2:20 PM','2:20 PM-3:00 PM','3:20 PM-4:00 PM','4:00 PM-4:40 PM','4:40 PM-5:20 PM','5:20 PM-6:00 PM','6:00 PM-6:40 PM','6:40 PM-7:20 PM','7:20 PM-8:00 PM','8:00 PM-8:40 PM','8:40 PM-9:20 PM'];
let specs=[], childs=[], schedule=[];

window.onload=()=>{
  // Populate selects
  depts.forEach(d=>document.getElementById('specDept').add(new Option(d,d)));
  depts.forEach(d=>document.getElementById('childNeeds').add(new Option(d,d)));
  plans.forEach(p=>document.getElementById('childPlan').add(new Option(p,p)));
  slots.forEach(s=>document.getElementById('specSlots').add(new Option(s,s)));
  slots.forEach(s=>document.getElementById('childSlots').add(new Option(s,s)));
  // Main nav
  document.querySelectorAll('nav.main button').forEach(b=>b.onclick=()=>showSection(b.dataset.target));
  // Sub nav
  document.querySelectorAll('nav.sub button').forEach(b=>b.onclick=()=>{document.querySelectorAll('nav.sub button').forEach(x=>x.classList.remove('active'));b.classList.add('active');renderTable(b.dataset.sec);});
  // Default
  showSection('specialists');
};

function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav.main button').forEach(b=>b.classList.remove('active'));
  document.querySelector(`nav.main button[data-target="${id}"]`).classList.add('active');
  if(id==='schedule'){
    const first=document.querySelector('nav.sub button');
    first.click();
  }
}

function addSpec(){
  specs.push({name:document.getElementById('specName').value,dept:document.getElementById('specDept').value,email:document.getElementById('specEmail').value,days:Array.from(document.getElementById('specDays').selectedOptions).map(o=>o.value),slots:Array.from(document.getElementById('specSlots').selectedOptions).map(o=>o.value)});
  renderSpecs();
}

function renderSpecs(){
  document.getElementById('tblSpecs').innerHTML=specs.map((s,i)=>`<tr><td>${s.name}</td><td>${s.dept}</td><td>${s.email}</td><td>${s.days.join(',')}</td><td>${s.slots.join(',')}</td><td><button class='btn delete-btn' onclick="deleteSpec(${i})">حذف</button></td></tr>`).join('');
}

function deleteSpec(i){ specs.splice(i,1); renderSpecs(); }

function addChild(){
  childs.push({name:document.getElementById('childName').value,spec:document.getElementById('childSpec').value,needs:Array.from(document.getElementById('childNeeds').selectedOptions).map(o=>o.value),plan:document.getElementById('childPlan').value,days:Array.from(document.getElementById('childDays').selectedOptions).map(o=>o.value),slots:Array.from(document.getElementById('childSlots').selectedOptions).map(o=>o.value)});
  renderChilds();
}

function renderChilds(){
  document.getElementById('tblChildren').innerHTML=childs.map((c,i)=>`<tr><td>${c.name}</td><td>${c.spec}</td><td>${c.needs.join(',')}</td><td>${c.plan}</td><td>${c.days.join(',')}</td><td>${c.slots.join(',')}</td><td><button class='btn delete-btn' onclick="deleteChild(${i})">حذف</button></td></tr>`).join('');
}

function deleteChild(i){ childs.splice(i,1); renderChilds(); }

function autoAssign(){
  schedule=[];
  childs.forEach(c=>{let max=parseInt(c.plan)||1,count=0;days.forEach(day=>{if(count<max&&c.days.includes(day)){c.slots.forEach(sl=>{if(count<max){schedule.push({day,slot:sl,dept:c.needs[count% c.needs.length],spec:c.spec,child:c.name});count++;}});}});});
  const sec=document.querySelector('nav.sub button.active').dataset.sec;
  renderTable(sec);
}

function renderTable(sec){
  const header=`<tr><th>الوقت/اليوم</th>${days.map(d=>`<th>${d}</th>`).join('')}</tr>`;
  const rows=slots.map(sl=>{let row=`<td>${sl}</td>`;days.forEach(day=>{const r=schedule.find(x=>x.day===day&&x.slot===sl&&x.dept===sec);row+=`<td class="dept-${sec.replace(/ /g,'\\ ')} state-${r?'محجوز':'متاح'}">${r?`${r.child} (${r.spec})`:''}<br>${r?`<button class='btn delete-btn' onclick="deleteSchedule('${day}','${sl}','${sec}')">حذف</button>`:''}</td>`;});return`<tr>${row}</tr>`;}).join('');
  document.getElementById('scheduleContainer').innerHTML=`<table><thead>${header}</thead><tbody>${rows}</tbody></table>`;
}

function deleteSchedule(day,sl,sec){ const idx=schedule.findIndex(x=>x.day===day&&x.slot===sl&&x.dept===sec); if(idx>-1) schedule.splice(idx,1); renderTable(sec); }

function sendEmails(){
  specs.forEach(s=>{const rows=schedule.filter(x=>x.spec===s.name).map(x=>`<tr><td>${x.day}</td><td>${x.slot}</td><td>${x.child}</td><td>${x.dept}</td></tr>`).join('');
    const html=`<div style="font-family:Arial;"><h2 style="color:var(--primary);">جدول المواعيد الأسبوعي</h2><p>عزيزي ${s.name}, يرجى الاطلاع على جدولك:</p><table border=1 cellpadding=8 cellspacing=0 style="width:100%;border-collapse:collapse;"><tr style="background:var(--secondary);"><th>يوم</th><th>فترة</th><th>طفل</th><th>قسم</th></tr>${rows}</table><p>تحيات إدارة مركز ينمو</p></div>`;
    window.open(`mailto:${s.email}?subject=${encodeURIComponent(`جدولك الأسبوعي - ${s.name}`)}&body=${encodeURIComponent(html)}`);
  });
}

function showFreeSlots(){
  const occ=schedule.map(x=>x.day+x.slot);
  const rows=days.map(day=>slots.filter(sl=>!occ.includes(day+sl)).map(sl=>`<tr><td>${day}</td><td>${sl}</td><td><input id='inp${day}${sl}' placeholder='اسم الطفل'></td><td><button class='btn' onclick="addRep('${day}','${sl}')">إضافة</button></td></tr>`).join('')).join('');
  document.getElementById('tblFree').innerHTML=rows;
}

function addRep(day,sl){const n=document.getElementById(`inp${day}${sl}`).value;if(!n)return;schedule.push({day,slot:sl,dept:'تعويض',spec:'',child:n});const sec=document.querySelector('nav.sub button.active').dataset.sec;renderTable(sec);showFreeSlots();}
</script>
</body>
</html>
