<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù†Ø¸Ø§Ù… Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²</title>
  <!-- Ø§Ø³ØªØ®Ø¯Ø§Ù… Tailwind CSS Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨Ø³ÙŠØ· -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- EmailJS SDK -->
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #F3F4F6;
      color: #1F2937;
      padding-bottom: 40px;
    }
    header {
      background-color: #059669;
      padding: 1rem;
      text-align: center;
      color: white;
    }
    h1 {
      font-size: 1.75rem;
    }
    section {
      background: white;
      padding: 1.25rem;
      margin: 1.5rem auto;
      border-radius: 0.5rem;
      max-width: 800px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }
    input, select, button {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 0.75rem;
      border: 1px solid #D1D5DB;
      border-radius: 0.375rem;
      outline: none;
    }
    input:focus, select:focus {
      border-color: #2563EB;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
    }
    button {
      background-color: #2563EB;
      color: white;
      font-weight: 600;
      transition: background-color 0.15s;
    }
    button:hover {
      background-color: #1E40AF;
    }
    .btn-small {
      background-color: #D97706;
      color: white;
      font-size: 0.875rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      transition: background-color 0.15s;
    }
    .btn-small:hover {
      background-color: #B45309;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #E5E7EB;
      padding: 0.75rem;
      text-align: center;
      font-size: 0.875rem;
    }
    th {
      background-color: #F3F4F6;
      font-weight: 600;
    }
    tr:nth-child(even) {
      background-color: #FAFAFA;
    }
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ù†Ø¸Ø§Ù… Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²</h1>
  </header>

  <!-- 1) Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† -->
  <section>
    <h2 class="text-xl font-semibold mb-4">1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ†</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
      <div>
        <label for="newSpec">Ø§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</label>
        <input type="text" id="newSpec" placeholder="Ù…Ø«Ø§Ù„: Ø¯. Ø£Ø­Ù…Ø¯" />
      </div>
      <div>
        <label for="newSpecEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="newSpecEmail" placeholder="example@email.com"/>
      </div>
      <div>
        <label for="newSpecDays">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</label>
        <input type="text" id="newSpecDays" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø¨ØªØŒØ§Ù„Ø£Ø­Ø¯" />
      </div>
      <div>
        <label for="newSpecTimes">ÙØªØ±Ø§Øª Ø§Ù„Ø¹Ù…Ù„</label>
        <input type="text" id="newSpecTimes" placeholder="Ù…Ø«Ø§Ù„: 1:00-1:40ØŒ1:40-2:20" />
      </div>
    </div>
    <div class="flex flex-col md:flex-row gap-2 mb-4">
      <button onclick="addSpec()">Ø¥Ø¶Ø§ÙØ© Ø£Ø®ØµØ§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯</button>
      <button onclick="loadSpecs()" class="btn-small">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
    <div class="overflow-x-auto">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
            <th>Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</th>
            <th>ÙØªØ±Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody id="specTableBody"></tbody>
      </table>
    </div>
  </section>

  <!-- 2) Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø·ÙØ§Ù„ -->
  <section>
    <h2 class="text-xl font-semibold mb-4">2. Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
      <div>
        <label for="childName">Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</label>
        <input type="text" id="childName" placeholder="Ù…Ø«Ø§Ù„: Ù„ÙŠÙ„Ù‰" />
      </div>
      <div>
        <label for="day">Ø§Ù„ÙŠÙˆÙ…</label>
        <select id="day">
          <option>Ø§Ù„Ø³Ø¨Øª</option><option>Ø§Ù„Ø£Ø­Ø¯</option><option>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
          <option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>Ø§Ù„Ø®Ù…ÙŠØ³</option>
        </select>
      </div>
      <div>
        <label for="timeSlot">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label>
        <select id="timeSlot">
          <option>1:00 - 1:40</option><option>1:40 - 2:20</option>
          <option>2:20 - 3:00</option><option>3:20 - 4:00</option>
          <option>4:00 - 4:40</option><option>4:40 - 5:20</option>
          <option>5:20 - 6:00</option><option>6:00 - 6:40</option>
          <option>6:40 - 7:20</option><option>7:20 - 8:00</option>
          <option>8:00 - 8:40</option><option>8:40 - 9:20</option>
        </select>
      </div>
      <div>
        <label for="subscription">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
        <select id="subscription">
          <option>24 Ø¬Ù„Ø³Ø©</option><option>36 Ø¬Ù„Ø³Ø©</option><option>48 Ø¬Ù„Ø³Ø©</option>
          <option>Ø³Ø§Ø¹Ø© Ø§Ø®ØªØ¨Ø§Ø±</option><option>Ø³Ø§Ø¹ØªÙŠÙ† Ø§Ø®ØªØ¨Ø§Ø±</option>
        </select>
      </div>
    </div>
    <div>
      <label>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</label>
      <div class="checkbox-group">
        <label><input type="checkbox" class="dept-chk" value="ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙˆÙƒ" /> ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙˆÙƒ</label>
        <label><input type="checkbox" class="dept-chk" value="ØªØ®Ø§Ø·Ø¨" /> ØªØ®Ø§Ø·Ø¨</label>
        <label><input type="checkbox" class="dept-chk" value="ØªÙ†Ù…ÙŠØ© Ù…Ù‡Ø§Ø±Ø§Øª" /> ØªÙ†Ù…ÙŠØ© Ù…Ù‡Ø§Ø±Ø§Øª</label>
        <label><input type="checkbox" class="dept-chk" value="Ø¬Ù„Ø³Ø© Ù†ÙØ³ÙŠØ©" /> Ø¬Ù„Ø³Ø© Ù†ÙØ³ÙŠØ©</label>
        <label><input type="checkbox" class="dept-chk" value="Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒØ§Ø¡" /> Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒØ§Ø¡</label>
      </div>
    </div>
    <button onclick="addAppt()">Ø­ÙØ¸ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø·ÙÙ„</button>
  </section>

  <!-- 3) Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ -->
  <section>
    <h2 class="text-xl font-semibold mb-4">3. Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div>
        <label for="filterSpec">ØªØµÙÙŠØ© Ø¨Ø§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</label>
        <input type="text" id="filterSpec" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯" />
      </div>
      <div class="flex items-end gap-2">
        <button onclick="filterAppts()">ØªØµÙÙŠØ©</button>
        <button onclick="renderAppts()">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div>
        <label for="specEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</label>
        <input type="email" id="specEmail" placeholder="ahmed@example.com" />
      </div>
      <div class="flex items-end">
        <button onclick="sendScheduleEmail()">Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</button>
      </div>
    </div>
    <div class="overflow-x-auto">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</th>
            <th>Ø§Ù„ÙŠÙˆÙ…</th>
            <th>Ø§Ù„ÙˆÙ‚Øª</th>
            <th>Ø§Ù„Ù‚Ø³Ù…</th>
            <th>Ø§Ø´ØªØ±Ø§Ùƒ</th>
            <th>Ø£Ø®ØµØ§Ø¦ÙŠ</th>
            <th>ØªØ¹ÙˆÙŠØ¶</th>
          </tr>
        </thead>
        <tbody id="apptTableBody"></tbody>
      </table>
    </div>
  </section>
</div>

<script>
  // ØªÙ‡ÙŠØ¦Ø© EmailJS
  emailjs.init('Ol1_k8IqKWQbPcbNv');

  // Ù…ØµÙÙˆÙØªØ§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
  let specialists = JSON.parse(localStorage.getItem('specs') || '[]');
  let appointments = JSON.parse(localStorage.getItem('appts') || '[]');

  // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  window.onload = () => {
    loadSpecs();
    renderAppts();
  };

  // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† =====
  function saveSpecs() {
    localStorage.setItem('specs', JSON.stringify(specialists));
    loadSpecs();
  }
  function loadSpecs() {
    const tbody = document.getElementById('specTableBody');
    tbody.innerHTML = '';
    specialists.forEach((s, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="border p-2">${idx + 1}</td>
        <td class="border p-2">${s.name}</td>
        <td class="border p-2">${s.email}</td>
        <td class="border p-2">${s.days}</td>
        <td class="border p-2">${s.times}</td>
        <td class="border p-2">
          <button class="btn-small" onclick="deleteSpec(${idx})">Ø­Ø°Ù</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }
  function addSpec() {
    const name = document.getElementById('newSpec').value.trim();
    const email = document.getElementById('newSpecEmail').value.trim();
    const days = document.getElementById('newSpecDays').value.trim();
    const times = document.getElementById('newSpecTimes').value.trim();
    if (!name || !email) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆØ¨Ø±ÙŠØ¯ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ');
      return;
    }
    specialists.push({ name, email, days, times });
    saveSpecs();
    document.getElementById('newSpec').value = '';
    document.getElementById('newSpecEmail').value = '';
    document.getElementById('newSpecDays').value = '';
    document.getElementById('newSpecTimes').value = '';
    alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ ÙˆØ­ÙØ¸Ù‡');
  }
  function deleteSpec(i) {
    if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠØŸ')) return;
    specialists.splice(i, 1);
    saveSpecs();
  }

  // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ =====
  function saveAppts() {
    localStorage.setItem('appts', JSON.stringify(appointments));
    renderAppts();
  }
  function renderAppts(list = appointments) {
    const tbody = document.getElementById('apptTableBody');
    tbody.innerHTML = '';
    list.forEach((a, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="border p-2">${idx + 1}</td>
        <td class="border p-2">${a.child}</td>
        <td class="border p-2">${a.day}</td>
        <td class="border p-2">${a.time}</td>
        <td class="border p-2">${a.dept}</td>
        <td class="border p-2">${a.sub}</td>
        <td class="border p-2">${a.spec || '-'}</td>
        <td class="border p-2">
          <button class="btn-small" onclick="toggleRepl(${idx})">
            ${a.type === 'ØªØ¹ÙˆÙŠØ¶' ? 'âœ”' : 'ØªØ¹ÙˆÙŠØ¶'}
          </button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }
  function addAppt() {
    const child = document.getElementById('childName').value.trim();
    const day = document.getElementById('day').value;
    const time = document.getElementById('timeSlot').value;
    const sub = document.getElementById('subscription').value;
    if (!child) {
      alert('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„');
      return;
    }
    const sameCount = appointments.filter(a => a.day === day && a.time === time).length;
    if (sameCount >= 5) {
      alert('Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø© Ù…Ù…ØªÙ„Ø¦Ø© (5 Ø£Ø·ÙØ§Ù„ Ø¨Ø§Ù„ÙØ¹Ù„)');
      return;
    }
    const depts = Array.from(document.querySelectorAll('.dept-chk'))
      .filter(cb => cb.checked).map(cb => cb.value);
    if (!depts.length) {
      alert('Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
      return;
    }
    depts.forEach(dept => {
      let assigned = '';
      for (const s of specialists) {
        const daysArr = s.days.split(',').map(d => d.trim());
        const timesArr = s.times.split(',').map(t => t.trim());
        if (daysArr.includes(day) && timesArr.includes(time)) {
          assigned = s.name;
          break;
        }
      }
      appointments.push({ child, day, time, dept, sub, spec: assigned, type: 'Ø¹Ø§Ø¯ÙŠ' });
    });
    document.getElementById('childName').value = '';
    document.querySelectorAll('.dept-chk').forEach(cb => cb.checked = false);
    saveAppts();
    alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ­ÙØ¸Ù‡Ø§');
  }
  function toggleRepl(i) {
    appointments[i].type = (appointments[i].type === 'ØªØ¹ÙˆÙŠØ¶' ? 'Ø¹Ø§Ø¯ÙŠ' : 'ØªØ¹ÙˆÙŠØ¶');
    saveAppts();
  }
  function filterAppts() {
    const f = document.getElementById('filterSpec').value.trim().toLowerCase();
    renderAppts(appointments.filter(a => a.spec.toLowerCase() === f));
  }

  // ===== Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ Ø¹Ø¨Ø± EmailJS =====
  function sendScheduleEmail() {
    const email = document.getElementById('specEmail').value.trim();
    const name = document.getElementById('filterSpec').value.trim();
    if (!email || !name) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ©');
      return;
    }
    const list = appointments.filter(a => a.spec.toLowerCase() === name.toLowerCase());
    if (!list.length) {
      alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ');
      return;
    }
    let html = `<h3 style="background:#059669;color:#fff;padding:10px;border-radius:6px;">
      Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯ ${name}
    </h3>`;
    html += `<table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse;width:100%;direction:rtl;">`;
    html += `<tr style="background:#F3F4F6;font-weight:bold;">
      <th>Ø·ÙÙ„</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ø´ØªØ±Ø§Ùƒ</th><th>Ù†ÙˆØ¹</th>
    </tr>`;
    list.forEach(a => {
      html += `<tr>
        <td>${a.child}</td>
        <td>${a.day}</td>
        <td>${a.time}</td>
        <td>${a.dept}</td>
        <td>${a.sub}</td>
        <td>${a.type}</td>
      </tr>`;
    });
    html += `</table><br/><p>Ù…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªÙ…Ù†ÙŠØ§ØªØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²</p>`;

    emailjs.send('service_cuzf74k', 'template_b04f8pi', {
      to_name: name,
      to_email: email,
      schedule_html: html
    })
    .then(_ => {
      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ ' + email);
    })
    .catch(e => {
      alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + JSON.stringify(e));
    });
  }
</script>
</body>
</html>
