<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù†Ø¸Ø§Ù… Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS (Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù†Ø¸ÙŠÙ) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>

  <style>
    :root {
      --color-mint: #87C8BC;
      --color-beige: #F5E6C8;
      --color-navy: #1F2F3D;
      --color-light: #FFF9E6;
      --font-base: 'Cairo', sans-serif;
    }
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font-base);
      background-color: var(--color-light);
      color: var(--color-navy);
      direction: rtl;
      min-height: 100vh;
    }
    header {
      background-color: var(--color-mint);
      padding: 20px; text-align: center;
    }
    header img { height: 60px; vertical-align: middle; }
    header h1 {
      display: inline-block; margin-left: 10px;
      color: #fff; font-size: 24px; font-weight: bold;
      vertical-align: middle;
    }
    main {
      max-width: 1100px; margin: 20px auto; padding: 0 10px;
    }
    h2 {
      font-size: 20px; margin-bottom: 12px;
      border-bottom: 3px solid var(--color-mint);
      display: inline-block; padding-bottom: 5px;
    }
    section {
      background-color: #fff; border-radius: 8px;
      padding: 20px; margin-bottom: 30px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .form-row {
      display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 18px;
    }
    .form-row > * { flex: 1; min-width: 180px; }
    input[type="text"],
    input[type="email"],
    select {
      width: 100%; padding: 8px; border: 1px solid #ccc;
      border-radius: 6px; font-size: 14px; outline: none;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    select:focus {
      border-color: var(--color-mint);
      box-shadow: 0 0 0 2px rgba(135,200,188,0.3);
    }
    .checkbox-group {
      display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 12px;
    }
    .checkbox-group label {
      display: flex; align-items: center; gap: 6px; font-weight: normal;
    }
    button {
      background-color: var(--color-mint); color: #fff;
      border: none; border-radius: 6px; padding: 10px 20px;
      font-size: 14px; cursor: pointer; transition: background-color 0.2s;
    }
    button:hover { background-color: var(--color-navy); }
    table {
      width: 100%; border-collapse: collapse; margin-top: 20px; text-align: center;
    }
    th, td {
      border: 1px solid #ddd; padding: 10px; font-size: 14px;
    }
    th {
      background-color: var(--color-beige); font-weight: bold;
    }
    tr:nth-child(even) { background-color: var(--color-light); }
    .btn-small {
      background-color: var(--color-beige); color: var(--color-navy);
      padding: 6px 12px; font-size: 12px; border-radius: 4px;
      transition: background-color 0.2s, color 0.2s;
    }
    .btn-small:hover { background-color: var(--color-navy); color: #fff; }
    @media (max-width: 768px) {
      .form-row { flex-direction: column; }
      h2 { font-size: 18px; }
      header h1 { display: block; margin-top: 8px; }
    }
  </style>
</head>
<body>
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <header>
    <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ÙƒØ²" />
    <h1>Ù†Ø¸Ø§Ù… Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±ÙƒØ²</h1>
  </header>

  <main>
    <!-- ===== 1) Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† ===== -->
    <section>
      <h2>1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ†</h2>
      <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø£Ø®ØµØ§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯ -->
      <div class="form-row">
        <div>
          <label for="newSpec">Ø§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</label>
          <input type="text" id="newSpec" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯" />
        </div>
        <div>
          <label for="newSpecEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="newSpecEmail" placeholder="ahmed@example.com" />
        </div>
        <div>
          <label for="newSpecDays">Ø§Ù„Ø£ÙŠØ§Ù… (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</label>
          <input type="text" id="newSpecDays" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø¨ØªØŒØ§Ù„Ø£Ø­Ø¯" />
        </div>
        <div>
          <label for="newSpecTimes">Ø§Ù„Ø£ÙˆÙ‚Ø§Øª (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©)</label>
          <input type="text" id="newSpecTimes" placeholder="Ù…Ø«Ø§Ù„: 1:00-1:40ØŒ1:40-2:20" />
        </div>
        <button onclick="addSpec()">Ø¥Ø¶Ø§ÙØ© Ø£Ø®ØµØ§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <button onclick="loadData()" class="btn-small mb-4">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <div class="overflow-x-auto">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</th>
              <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
              <th>ØªÙˆØ§ÙØ± (Ø£ÙŠØ§Ù…)</th>
              <th>ØªÙˆØ§ÙØ± (Ø£ÙˆÙ‚Ø§Øª)</th>
              <th>Ø­Ø°Ù</th>
            </tr>
          </thead>
          <tbody id="specTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- ===== 2) Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø·ÙØ§Ù„ ===== -->
    <section>
      <h2>2. Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</h2>
      <div class="form-row">
        <div>
          <label for="childName">Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</label>
          <input type="text" id="childName" placeholder="Ù…Ø«Ø§Ù„: Ù„ÙŠÙ„Ù‰" />
        </div>
        <div>
          <label for="day">Ø§Ù„ÙŠÙˆÙ…</label>
          <select id="day">
            <option>Ø§Ù„Ø³Ø¨Øª</option><option>Ø§Ù„Ø£Ø­Ø¯</option><option>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
            <option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>Ø§Ù„Ø®Ù…ÙŠØ³</option>
          </select>
        </div>
        <div>
          <label for="timeSlot">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label>
          <select id="timeSlot">
            <option>1:00 - 1:40</option><option>1:40 - 2:20</option><option>2:20 - 3:00</option>
            <option>3:20 - 4:00</option><option>4:00 - 4:40</option><option>4:40 - 5:20</option>
            <option>5:20 - 6:00</option><option>6:00 - 6:40</option><option>6:40 - 7:20</option>
            <option>7:20 - 8:00</option><option>8:00 - 8:40</option><option>8:40 - 9:20</option>
          </select>
        </div>
        <div>
          <label for="subscription">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
          <select id="subscription">
            <option>24 Ø¬Ù„Ø³Ø©</option><option>36 Ø¬Ù„Ø³Ø©</option><option>48 Ø¬Ù„Ø³Ø©</option>
            <option>Ø³Ø§Ø¹Ø© Ø§Ø®ØªØ¨Ø§Ø±</option><option>Ø³Ø§Ø¹ØªÙŠÙ† Ø§Ø®ØªØ¨Ø§Ø±</option>
          </select>
        </div>
      </div>
      <div class="checkbox-group">
        <label><input type="checkbox" class="dept-chk" value="ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙˆÙƒ" /> ØªØ¹Ø¯ÙŠÙ„ Ø³Ù„ÙˆÙƒ</label>
        <label><input type="checkbox" class="dept-chk" value="ØªØ®Ø§Ø·Ø¨" /> ØªØ®Ø§Ø·Ø¨</label>
        <label><input type="checkbox" class="dept-chk" value="ØªÙ†Ù…ÙŠØ© Ù…Ù‡Ø§Ø±Ø§Øª" /> ØªÙ†Ù…ÙŠØ© Ù…Ù‡Ø§Ø±Ø§Øª</label>
        <label><input type="checkbox" class="dept-chk" value="Ø¬Ù„Ø³Ø© Ù†ÙØ³ÙŠØ©" /> Ø¬Ù„Ø³Ø© Ù†ÙØ³ÙŠØ©</label>
        <label><input type="checkbox" class="dept-chk" value="Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒØ§Ø¡" /> Ø§Ø®ØªØ¨Ø§Ø± Ø°ÙƒØ§Ø¡</label>
      </div>
      <button onclick="addAppts()">Ø­ÙØ¸ Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø·ÙÙ„</button>
    </section>

    <!-- ===== 3) Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ===== -->
    <section>
      <h2>3. Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h2>
      <div class="form-row mb-4">
        <div>
          <label for="filterSpec">ØªØµÙÙŠØ© Ø¨Ø§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</label>
          <input type="text" id="filterSpec" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯" />
        </div>
        <button onclick="filterAppts()" class="self-end">ØªØµÙÙŠØ©</button>
        <button onclick="renderAppts()" class="self-end">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
      </div>
      <div class="form-row mb-4">
        <div>
          <label for="specEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</label>
          <input type="email" id="specEmail" placeholder="ahmed@example.com" />
        </div>
        <button onclick="sendScheduleEmail()" class="self-end">Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</button>
      </div>
      <div class="overflow-x-auto">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„</th>
              <th>Ø§Ù„ÙŠÙˆÙ…</th>
              <th>Ø§Ù„ÙˆÙ‚Øª</th>
              <th>Ø§Ù„Ù‚Ø³Ù…</th>
              <th>Ø§Ø´ØªØ±Ø§Ùƒ</th>
              <th>Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</th>
              <th>ØªØ¹ÙˆÙŠØ¶</th>
            </tr>
          </thead>
          <tbody id="apptTableBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // ===== 1) Ø¥Ø¹Ø¯Ø§Ø¯ Firebase =====
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBinpejpZQv71xxhJrlYcET-uNLPL0pROY",
  authDomain: "ynmo-center-scheduler.firebaseapp.com",
  databaseURL: "https://ynmo-center-scheduler-default-rtdb.firebaseio.com",
  projectId: "ynmo-center-scheduler",
  storageBucket: "ynmo-center-scheduler.firebasestorage.app",
  messagingSenderId: "287665928063",
  appId: "1:287665928063:web:67f6bccd66a25ef0118c4a"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

    // ===== 2) ØªÙ‡ÙŠØ¦Ø© EmailJS =====
    emailjs.init('Ol1_k8IqKWQbPcbNv');

    // ===== 3) ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore ÙˆØ¹Ø±Ø¶Ù‡Ø§ =====
    let specialists = [];
    let appts = [];

    function loadData() {
      // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† Ù…Ù† Collection "specialists"
      db.collection('specialists').get().then(snapshot => {
        specialists = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderSpecs();
      });
      // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ù† Collection "appointments"
      db.collection('appointments').get().then(snapshot => {
        appts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderAppts();
      });
      alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore');
    }

    // Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
    window.onload = () => {
      loadData();
    };

    // ===== 4) ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† =====
    function renderSpecs() {
      const tbody = document.getElementById('specTableBody');
      tbody.innerHTML = '';
      specialists.forEach((s, idx) => {
        const tr = document.createElement('tr');
        const days = s.days || '-';
        const times = s.times || '-';
        tr.innerHTML = `
          <td class="border p-2">${idx + 1}</td>
          <td class="border p-2">${s.name}</td>
          <td class="border p-2">${s.email}</td>
          <td class="border p-2">${days}</td>
          <td class="border p-2">${times}</td>
          <td class="border p-2">
            <button onclick="deleteSpec('${s.id}')" class="btn-small">Ø­Ø°Ù</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function addSpec() {
      const name = document.getElementById('newSpec').value.trim();
      const email = document.getElementById('newSpecEmail').value.trim();
      const days = document.getElementById('newSpecDays').value.trim();
      const times = document.getElementById('newSpecTimes').value.trim();
      if (!name || !email) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆØ¨Ø±ÙŠØ¯ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ');
        return;
      }
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø¥Ù„Ù‰ Firestore
      db.collection('specialists').add({
        name,
        email,
        days,
        times
      }).then(docRef => {
        specialists.push({ id: docRef.id, name, email, days, times });
        renderSpecs();
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('newSpec').value = '';
        document.getElementById('newSpecEmail').value = '';
        document.getElementById('newSpecDays').value = '';
        document.getElementById('newSpecTimes').value = '';
        alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Firestore');
      }).catch(err => {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + err);
      });
    }

    function deleteSpec(id) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ')) return;
      db.collection('specialists').doc(id).delete().then(() => {
        specialists = specialists.filter(s => s.id !== id);
        renderSpecs();
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ');
      });
    }

    // ===== 5) ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ =====
    function renderAppts(list = appts) {
      const tbody = document.getElementById('apptTableBody');
      tbody.innerHTML = '';
      list.forEach((a, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="border p-2">${idx + 1}</td>
          <td class="border p-2">${a.child}</td>
          <td class="border p-2">${a.day}</td>
          <td class="border p-2">${a.time}</td>
          <td class="border p-2">${a.dept}</td>
          <td class="border p-2">${a.sub}</td>
          <td class="border p-2">${a.spec || '-'}</td>
          <td class="border p-2">
            <button onclick="toggleRepl('${a.id}')" class="btn-small">
              ${a.type === 'ØªØ¹ÙˆÙŠØ¶' ? 'âœ”' : 'ØªØ¹ÙˆÙŠØ¶'}
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function addAppts() {
      const child = document.getElementById('childName').value.trim();
      const day = document.getElementById('day').value;
      const time = document.getElementById('timeSlot').value;
      const sub = document.getElementById('subscription').value;
      if (!child) {
        alert('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„');
        return;
      }
      // Ù„Ø§ Ù†Ø³Ù…Ø­ Ø¨Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø£Ø·ÙØ§Ù„ Ù„Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ÙˆÙ‚Øª:
      const countSameSlot = appts.filter(a => a.day === day && a.time === time).length;
      if (countSameSlot >= 5) {
        alert('Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø© Ù…Ù…ØªÙ„Ø¦Ø© (5 Ø£Ø·ÙØ§Ù„ Ø¨Ø§Ù„ÙØ¹Ù„)');
        return;
      }
      // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
      const depts = Array.from(document.querySelectorAll('.dept-chk'))
        .filter(cb => cb.checked)
        .map(cb => cb.value);
      if (!depts.length) {
        alert('Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
      }
      // Ù„ÙƒÙ„ Ù‚Ø³Ù…ØŒ Ù†Ø¨Ø­Ø« Ø£ÙˆÙ„ Ø£Ø®ØµØ§Ø¦ÙŠ Ù…ØªØ§Ø­ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ… + Ø§Ù„ÙˆÙ‚Øª (Ù…Ù† Ø­Ù‚Ù„ days/times):
      depts.forEach(dept => {
        let assignedSpec = '';
        for (const s of specialists) {
          // Ø¥Ø°Ø§ Ø­Ù‚Ù„ s.days ÙŠØ­ØªÙˆÙŠ Ø§Ù„ÙŠÙˆÙ… Ùˆ s.times ÙŠØ­ØªÙˆÙŠ Ø§Ù„ÙˆÙ‚Øª
          if (s.days.split(',').map(d => d.trim()).includes(day) &&
              s.times.split(',').map(t => t.trim()).includes(time)) {
            assignedSpec = s.name;
            break;
          }
        }
        // Ø£Ø¶Ù Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¥Ù„Ù‰ Firestore
        db.collection('appointments').add({
          child,
          day,
          time,
          dept,
          sub,
          spec: assignedSpec,
          type: 'Ø¹Ø§Ø¯ÙŠ'
        }).then(docRef => {
          appts.push({ id: docRef.id, child, day, time, dept, sub, spec: assignedSpec, type: 'Ø¹Ø§Ø¯ÙŠ' });
          renderAppts();
        }).catch(err => {
          alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯: ' + err);
        });
      });
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙÙˆØ±Ù‹Ø§ ÙƒØ±Ø¯ ÙØ¹Ù„
      document.getElementById('childName').value = '';
      document.querySelectorAll('.dept-chk').forEach(cb => cb.checked = false);
      alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¥Ù„Ù‰ Firestore');
    }

    function toggleRepl(id) {
      // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹ÙˆÙŠØ¶ ÙÙŠ Firestore
      const appt = appts.find(a => a.id === id);
      if (!appt) return;
      const newType = (appt.type === 'ØªØ¹ÙˆÙŠØ¶') ? 'Ø¹Ø§Ø¯ÙŠ' : 'ØªØ¹ÙˆÙŠØ¶';
      db.collection('appointments').doc(id).update({ type: newType })
        .then(() => {
          appt.type = newType;
          renderAppts();
        })
        .catch(err => {
          alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹ÙˆÙŠØ¶: ' + err);
        });
    }

    function filterAppts() {
      const f = document.getElementById('filterSpec').value.trim().toLowerCase();
      renderAppts(appts.filter(a => a.spec.toLowerCase() === f));
    }

    // ===== 6) Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ Ø¹Ø¨Ø± EmailJS =====
    function sendScheduleEmail() {
      const email = document.getElementById('specEmail').value.trim();
      const name = document.getElementById('filterSpec').value.trim();
      if (!email || !name) {
        alert('ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ§Ø³Ù… Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ ÙÙŠ Ø§Ù„ØªØµÙÙŠØ©.');
        return;
      }
      const list = appts.filter(a => a.spec.toLowerCase() === name.toLowerCase());
      if (!list.length) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ.');
        return;
      }
      let html = `<h3 style="background:var(--color-mint);color:#fff;padding:10px;border-radius:5px;">
        Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§Ø¹ÙŠØ¯ ${name}
      </h3>`;
      html += `<table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse;width:100%;direction:rtl;">`;
      html += `<tr style="background:var(--color-beige);font-weight:bold;">
        <th>Ø·ÙÙ„</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ø´ØªØ±Ø§Ùƒ</th><th>Ù†ÙˆØ¹</th>
      </tr>`;
      list.forEach(a => {
        html += `<tr>
          <td>${a.child}</td>
          <td>${a.day}</td>
          <td>${a.time}</td>
          <td>${a.dept}</td>
          <td>${a.sub}</td>
          <td>${a.type}</td>
        </tr>`;
      });
      html += `</table><br/><p>Ù…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªÙ…Ù†ÙŠØ§ØªØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²</p>`;

      emailjs.send('service_cuzf74k', 'template_b04f8pi', {
        to_name: name,
        to_email: email,
        schedule_html: html
      })
      .then(_ => {
        alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ ' + email);
      })
      .catch(e => {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + JSON.stringify(e));
      });
    }
  </script>
</body>
</html>
